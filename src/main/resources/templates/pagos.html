<div>

    <div class="flex items-center justify-between mb-6">
        <div class="flex items-center gap-4">
            <label for="estadoFilterPagos" class="text-sm text-gray-600">Estado</label>
            <select id="estadoFilterPagos" class="text-sm px-2 py-1 w-36 border rounded">
                <option value="todas">Todas</option>
                <option value="Completado">Completado</option>
                <option value="Parcial">Parcial</option>
            </select>
        </div>
        <div class="flex items-center">
            <a href="/pagos/nuevo" class="inline-flex items-center gap-2 bg-violet-600 hover:bg-violet-700 text-white px-4 py-2 rounded-md shadow">
                Nuevo pago
            </a>
        </div>
    </div>

    <div class="overflow-x-auto">
        <table class="w-full bg-white shadow rounded overflow-hidden">
            <thead class="bg-gray-50">
                <tr>
                    <th class="p-3 text-left text-sm text-gray-600">ID</th>
                    <th class="p-3 text-left text-sm text-gray-600">Cliente</th>
                    <th class="p-3 text-left text-sm text-gray-600">Fecha</th>
                    <th class="p-3 text-left text-sm text-gray-600">Estado</th>
                    <th class="p-3 text-left text-sm text-gray-600">Monto</th>
                    <th class="p-3 text-left text-sm text-gray-600">Detalle</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="pago : ${pagos}" class="border-b hover:bg-gray-50">
                    <td class="p-3" th:text="${pago.id}"></td>
                    <td class="p-3" th:text="${pago.cliente != null ? pago.cliente.razonSocial : 'N/A'}"></td>
                    <td class="p-3" th:text="${#temporals.format(pago.fechaPago, 'dd/MM/yyyy')}"></td>
                    <td class="p-3">
                        <span class="inline-block px-2 py-1 rounded text-white text-xs" th:classappend="${estadosPago[pago.id] == 'Completado' ? ' bg-green-600' : (estadosPago[pago.id] == 'Parcial' ? ' bg-yellow-500' : ' bg-gray-500')}" th:text="${estadosPago[pago.id]}"></span>
                    </td>
                    <td class="p-3 monto-cell" th:attr="data-amount=${pago.montoIngresado}" th:text="${pago.montoIngresado}"></td>
                    <td class="p-3"><a th:href="@{/pagos/{id}(id=${pago.id})}" class="text-blue-600 hover:underline">Ver</a></td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
</div>

    <div class="mt-4 flex items-center justify-between">
        <div class="text-sm text-gray-500">Total pagos: <span id="totalCountPagos" class="ml-2 font-medium" th:text="${pagosPage != null ? pagosPage.totalElements : pagos.size()}">0</span></div>
        <div>
            <nav class="inline-flex rounded-md shadow-sm" th:if="${pagosPage != null && pagosPage.totalPages > 1}">
                <a th:href="@{/pagos(page=${pagosPage.number - 1}, size=${pagosPage.size})}"
                   th:classappend="${pagosPage.first} ? 'opacity-50 pointer-events-none' : ''"
                   class="px-3 py-2 border bg-white hover:bg-gray-50">Anterior</a>
                <span class="px-3 py-2 border bg-white">Página <span th:text="${pagosPage.number + 1}">1</span> de <span th:text="${pagosPage.totalPages}">1</span></span>
                <a th:href="@{/pagos(page=${pagosPage.number + 1}, size=${pagosPage.size})}"
                   th:classappend="${pagosPage.last} ? 'opacity-50 pointer-events-none' : ''"
                   class="px-3 py-2 border bg-white hover:bg-gray-50">Siguiente</a>
            </nav>
        </div>
    </div>
</div>
</div>

<script>
    // formatea las celdas de monto a formato moneda (cliente-side)
    (function(){
        try{
            const fmt = new Intl.NumberFormat('es-AR',{ style: 'currency', currency: 'ARS', minimumFractionDigits: 2 });
            document.querySelectorAll('.monto-cell').forEach(td => {
                const a = td.getAttribute('data-amount');
                const n = Number(a || 0);
                td.textContent = fmt.format(isNaN(n) ? 0 : n);
            });
        }catch(e){/* no bloquear si falla */}
    })();

    // Filtro dinámico por estado en la vista de pagos (cliente-side)
    (function(){
        const select = document.getElementById('estadoFilterPagos');
        const totalEl = document.getElementById('totalCountPagos');
        if(!select) return;

        function updateVisibleCount(){
            const rows = document.querySelectorAll('tbody tr');
            let visible = 0;
            rows.forEach(r => { if(r.style.display !== 'none') visible++; });
            if(totalEl) totalEl.textContent = String(visible);
        }

        function applyFilter(){
            const val = (select.value || 'todas').toLowerCase();
            const rows = document.querySelectorAll('tbody tr');
            rows.forEach(r => {
                const estadoSpan = r.querySelector('td:nth-child(4) span');
                const text = estadoSpan ? estadoSpan.textContent.trim().toLowerCase() : '';
                if(val === 'todas' || text === val){
                    r.style.display = '';
                } else {
                    r.style.display = 'none';
                }
            });
            updateVisibleCount();
        }

        select.addEventListener('change', applyFilter);
        // asegurar contador correcto al cargar
        document.addEventListener('DOMContentLoaded', updateVisibleCount);
    })();
</script>
